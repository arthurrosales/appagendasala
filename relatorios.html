<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Relatórios</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body class="bg-light">

<nav class="navbar bg-white shadow-sm px-4">
    <h4 class="mb-0">Relatórios</h4>
    <a href="agenda.html" class="btn btn-secondary">Voltar</a>
</nav>

<div class="container mt-4">

    <h5 class="mt-4">1. Taxa de Ocupação por Sala</h5>
    <canvas id="graficoSalas" height="100"></canvas>

    <h5 class="mt-5">2. Reservas por Horário</h5>
    <canvas id="graficoHorarios" height="100"></canvas>

    <h5 class="mt-5">3. Reservas por Dia da Semana</h5>
    <canvas id="graficoSemana" height="100"></canvas>

</div>

<script>

function carregarReservas() {
    return JSON.parse(localStorage.getItem("reservas")) || [];
}

const reservas = carregarReservas();

// --------------------------------------------
// GRÁFICO 1 – OCUPAÇÃO POR SALA
// --------------------------------------------

const salas = ["Sala 1", "Sala 2", "Sala 3"];
const ocupacaoPorSala = [0, 0, 0];

reservas.forEach(r => {
    const idx = salas.indexOf(r.sala);
    if (idx >= 0) ocupacaoPorSala[idx]++;
});

new Chart(document.getElementById("graficoSalas"), {
    type: "bar",
    data: {
        labels: salas,
        datasets: [{
            label: "Reservas",
            data: ocupacaoPorSala,
            borderWidth: 1
        }]
    }
});

// --------------------------------------------
// GRÁFICO 2 – RESERVAS POR HORÁRIO
// --------------------------------------------

const horarios = {};
reservas.forEach(r => {
    horarios[r.horario] = (horarios[r.horario] || 0) + 1;
});

new Chart(document.getElementById("graficoHorarios"), {
    type: "line",
    data: {
        labels: Object.keys(horarios),
        datasets: [{
            label: "Reservas por horário",
            data: Object.values(horarios),
            borderWidth: 2,
            tension: 0.3
        }]
    }
});

// --------------------------------------------
// GRÁFICO 3 – DIA DA SEMANA
// --------------------------------------------

function diaSemana(dataStr) {
    const dias = ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb"];
    const d = new Date(dataStr);
    return dias[d.getUTCDay()];
}

const semana = { Dom:0, Seg:0, Ter:0, Qua:0, Qui:0, Sex:0, Sáb:0 };

reservas.forEach(r => {
    let d = diaSemana(r.data);
    semana[d]++;
});

new Chart(document.getElementById("graficoSemana"), {
    type: "pie",
    data: {
        labels: Object.keys(semana),
        datasets: [{
            label: "Reservas",
            data: Object.values(semana),
            borderWidth: 1
        }]
    }
});

</script>

</body>
</html>
